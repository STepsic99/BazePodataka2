-- Generated by Oracle SQL Developer Data Modeler 21.4.1.349.1605
--   at:        2022-01-12 22:28:19 CET
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE cisti (
    spremacica_idzap INTEGER NOT NULL,
    prostorija_idprs INTEGER NOT NULL
);

ALTER TABLE cisti ADD CONSTRAINT cisti_pk PRIMARY KEY ( spremacica_idzap,
                                                        prostorija_idprs );

CREATE TABLE clan_dez_tima (
    idzap INTEGER NOT NULL
);

ALTER TABLE clan_dez_tima ADD CONSTRAINT clan_dez_tima_pk PRIMARY KEY ( idzap );

CREATE TABLE dezinfikuje (
    clan_dez_tima_idzap INTEGER NOT NULL,
    prostorija_idprs    INTEGER NOT NULL
);

ALTER TABLE dezinfikuje ADD CONSTRAINT dezinfikuje_pk PRIMARY KEY ( clan_dez_tima_idzap,
                                                                    prostorija_idprs );

CREATE TABLE formular (
    dtmf          DATE NOT NULL,
    izbvak        VARCHAR2(24) NOT NULL,
    alrg          CHAR(1) NOT NULL,
    pacijent_jmbg VARCHAR2(13) NOT NULL
);

ALTER TABLE formular
    ADD CHECK ( izbvak IN ( 'FAJZER', 'SINOFARM', 'SPUTNIK' ) );

ALTER TABLE formular ADD CONSTRAINT formular_pk PRIMARY KEY ( dtmf,
                                                              pacijent_jmbg );

CREATE TABLE frizider (
    idf              INTEGER NOT NULL,
    temp             NUMBER(10, 2) NOT NULL,
    brvak            INTEGER NOT NULL,
    prostorija_idprs INTEGER NOT NULL
);

ALTER TABLE frizider ADD CONSTRAINT frizider_pk PRIMARY KEY ( idf );

CREATE TABLE ima (
    lekar_idzap         INTEGER NOT NULL,
    specijalnost_idspec INTEGER NOT NULL
);

ALTER TABLE ima ADD CONSTRAINT ima_pk PRIMARY KEY ( lekar_idzap,
                                                    specijalnost_idspec );

CREATE TABLE lekar (
    idzap   INTEGER NOT NULL,
    brliclk VARCHAR2(6) NOT NULL
);

ALTER TABLE lekar ADD CONSTRAINT lekar_pk PRIMARY KEY ( idzap );

CREATE TABLE med_sestra (
    idzap   INTEGER NOT NULL,
    brlicms VARCHAR2(6) NOT NULL
);

ALTER TABLE med_sestra ADD CONSTRAINT med_sestra_pk PRIMARY KEY ( idzap );

CREATE TABLE medicinsko (
    idzap INTEGER NOT NULL,
    tipmr VARCHAR2(20) NOT NULL
);

ALTER TABLE medicinsko
    ADD CONSTRAINT ch_inh_medicinsko CHECK ( tipmr IN ( 'Lekar', 'Med_sestra' ) );

ALTER TABLE medicinsko ADD CONSTRAINT medicinsko_pk PRIMARY KEY ( idzap );

CREATE TABLE nalazi_se (
    racunar_sistem_idr INTEGER NOT NULL,
    prostorija_idprs   INTEGER NOT NULL
);

ALTER TABLE nalazi_se ADD CONSTRAINT nalazi_se_pk PRIMARY KEY ( racunar_sistem_idr,
                                                                prostorija_idprs );

CREATE TABLE nemedicinsko (
    idzap  INTEGER NOT NULL,
    tipnmr VARCHAR2(40) NOT NULL
);

ALTER TABLE nemedicinsko
    ADD CONSTRAINT ch_inh_nemedicinsko CHECK ( tipnmr IN ( 'Clan_dez_tima', 'Spremacica', 'Teh_podrska' ) );

ALTER TABLE nemedicinsko ADD CONSTRAINT nemedicinsko_pk PRIMARY KEY ( idzap );

CREATE TABLE odrzava (
    teh_podrska_idzap            INTEGER NOT NULL,
    nalazi_se_racunar_sistem_idr INTEGER NOT NULL,
    nalazi_se_prostorija_idprs   INTEGER NOT NULL
);

ALTER TABLE odrzava
    ADD CONSTRAINT odrzava_pk PRIMARY KEY ( teh_podrska_idzap,
                                            nalazi_se_racunar_sistem_idr,
                                            nalazi_se_prostorija_idprs );

CREATE TABLE pacijent (
    jmbg VARCHAR2(13) NOT NULL,
    imep VARCHAR2(28) NOT NULL,
    przp VARCHAR2(28) NOT NULL
);

ALTER TABLE pacijent ADD CONSTRAINT pacijent_pk PRIMARY KEY ( jmbg );

CREATE TABLE pregled (
    dtmp          DATE NOT NULL,
    odbruk        VARCHAR2(5) NOT NULL,
    lekar_idzap   INTEGER NOT NULL,
    pacijent_jmbg VARCHAR2(13) NOT NULL
);

ALTER TABLE pregled
    ADD CHECK ( odbruk IN ( 'DESNA', 'LEVA' ) );

ALTER TABLE pregled
    ADD CONSTRAINT pregled_pk PRIMARY KEY ( dtmp,
                                            lekar_idzap,
                                            pacijent_jmbg );

CREATE TABLE prostorija (
    idprs INTEGER NOT NULL,
    pvr   INTEGER NOT NULL,
    nmn   VARCHAR2(28)
);

ALTER TABLE prostorija ADD CONSTRAINT prostorija_pk PRIMARY KEY ( idprs );

CREATE TABLE racunar_sistem (
    idr INTEGER NOT NULL
);

ALTER TABLE racunar_sistem ADD CONSTRAINT racunar_sistem_pk PRIMARY KEY ( idr );

CREATE TABLE specijalnost (
    idspec  INTEGER NOT NULL,
    nazspec VARCHAR2(28) NOT NULL
);

ALTER TABLE specijalnost ADD CONSTRAINT specijalnost_pk PRIMARY KEY ( idspec );

CREATE TABLE spremacica (
    idzap INTEGER NOT NULL
);

ALTER TABLE spremacica ADD CONSTRAINT spremacica_pk PRIMARY KEY ( idzap );

CREATE TABLE teh_podrska (
    idzap INTEGER NOT NULL
);

ALTER TABLE teh_podrska ADD CONSTRAINT teh_podrska_pk PRIMARY KEY ( idzap );

CREATE TABLE vakcina (
    srb          VARCHAR2(6) NOT NULL,
    tipv         VARCHAR2(24) NOT NULL,
    uptdo        DATE NOT NULL,
    frizider_idf INTEGER NOT NULL
);

ALTER TABLE vakcina
    ADD CHECK ( tipv IN ( 'FAJZER', 'SINOFARM', 'SPUTNIK' ) );

ALTER TABLE vakcina ADD CONSTRAINT vakcina_pk PRIMARY KEY ( srb );

CREATE TABLE vakcinacija (
    dtmv             DATE NOT NULL,
    rdbr             INTEGER NOT NULL,
    med_sestra_idzap INTEGER NOT NULL,
    pacijent_jmbg    VARCHAR2(13) NOT NULL
);

ALTER TABLE vakcinacija
    ADD CONSTRAINT vakcinacija_pk PRIMARY KEY ( dtmv,
                                                med_sestra_idzap,
                                                pacijent_jmbg );

CREATE TABLE zaposleni (
    idzap           INTEGER NOT NULL,
    imezap          VARCHAR2(28) NOT NULL,
    przzap          VARCHAR2(28) NOT NULL,
    tipzap          VARCHAR2(28) NOT NULL,
    zaposleni_idzap INTEGER
);

ALTER TABLE zaposleni
    ADD CONSTRAINT ch_inh_zaposleni CHECK ( tipzap IN ( 'Clan_dez_tima', 'Lekar', 'Med_sestra', 'Spremacica', 'Teh_podrska' ) );

ALTER TABLE zaposleni ADD CONSTRAINT zaposleni_pk PRIMARY KEY ( idzap );

ALTER TABLE cisti
    ADD CONSTRAINT cisti_prostorija_fk FOREIGN KEY ( prostorija_idprs )
        REFERENCES prostorija ( idprs );

ALTER TABLE cisti
    ADD CONSTRAINT cisti_spremacica_fk FOREIGN KEY ( spremacica_idzap )
        REFERENCES spremacica ( idzap );

ALTER TABLE dezinfikuje
    ADD CONSTRAINT dezinfikuje_clan_dez_tima_fk FOREIGN KEY ( clan_dez_tima_idzap )
        REFERENCES clan_dez_tima ( idzap );

ALTER TABLE dezinfikuje
    ADD CONSTRAINT dezinfikuje_prostorija_fk FOREIGN KEY ( prostorija_idprs )
        REFERENCES prostorija ( idprs );

ALTER TABLE formular
    ADD CONSTRAINT formular_pacijent_fk FOREIGN KEY ( pacijent_jmbg )
        REFERENCES pacijent ( jmbg );

ALTER TABLE frizider
    ADD CONSTRAINT frizider_prostorija_fk FOREIGN KEY ( prostorija_idprs )
        REFERENCES prostorija ( idprs );

ALTER TABLE ima
    ADD CONSTRAINT ima_lekar_fk FOREIGN KEY ( lekar_idzap )
        REFERENCES lekar ( idzap );

ALTER TABLE ima
    ADD CONSTRAINT ima_specijalnost_fk FOREIGN KEY ( specijalnost_idspec )
        REFERENCES specijalnost ( idspec );

ALTER TABLE nalazi_se
    ADD CONSTRAINT nalazi_se_prostorija_fk FOREIGN KEY ( prostorija_idprs )
        REFERENCES prostorija ( idprs );

ALTER TABLE nalazi_se
    ADD CONSTRAINT nalazi_se_racunar_sistem_fk FOREIGN KEY ( racunar_sistem_idr )
        REFERENCES racunar_sistem ( idr );

ALTER TABLE odrzava
    ADD CONSTRAINT odrzava_nalazi_se_fk FOREIGN KEY ( nalazi_se_racunar_sistem_idr,
                                                      nalazi_se_prostorija_idprs )
        REFERENCES nalazi_se ( racunar_sistem_idr,
                               prostorija_idprs );

ALTER TABLE odrzava
    ADD CONSTRAINT odrzava_teh_podrska_fk FOREIGN KEY ( teh_podrska_idzap )
        REFERENCES teh_podrska ( idzap );

ALTER TABLE pregled
    ADD CONSTRAINT pregled_lekar_fk FOREIGN KEY ( lekar_idzap )
        REFERENCES lekar ( idzap );

ALTER TABLE pregled
    ADD CONSTRAINT pregled_pacijent_fk FOREIGN KEY ( pacijent_jmbg )
        REFERENCES pacijent ( jmbg );

ALTER TABLE vakcina
    ADD CONSTRAINT vakcina_frizider_fk FOREIGN KEY ( frizider_idf )
        REFERENCES frizider ( idf );

ALTER TABLE vakcinacija
    ADD CONSTRAINT vakcinacija_med_sestra_fk FOREIGN KEY ( med_sestra_idzap )
        REFERENCES med_sestra ( idzap );

ALTER TABLE vakcinacija
    ADD CONSTRAINT vakcinacija_pacijent_fk FOREIGN KEY ( pacijent_jmbg )
        REFERENCES pacijent ( jmbg );

ALTER TABLE zaposleni
    ADD CONSTRAINT zaposleni_zaposleni_fk FOREIGN KEY ( zaposleni_idzap )
        REFERENCES zaposleni ( idzap );



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            22
-- CREATE INDEX                             0
-- ALTER TABLE                             46
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0


insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (1,'Pera','Peric', 'Lekar',null);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (2,'Mika','Mikic', 'Lekar',null);
insert into SPECIJALNOST (idspec,nazspec) values (1, 'Fizijatar');
insert into LEKAR(idzap,brliclk) values (1,123123);
insert into IMA (lekar_idzap,specijalnost_idspec) values (1,1);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (3,'Mara','Maric', 'Teh_podrska',null);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (4,'Marko','Markovic', 'Clan_dez_tima',null);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (5,'Zika','Zikic', 'Lekar',null);
insert into LEKAR(idzap,brliclk) values (5,555555);
insert into IMA (lekar_idzap,specijalnost_idspec) values (5,1);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (6,'Ana','Anic', 'Lekar',null);
insert into LEKAR(idzap,brliclk) values (6,666666);
insert into IMA (lekar_idzap,specijalnost_idspec) values (6,1);
insert into LEKAR(idzap,brliclk) values (2,222222);
insert into SPECIJALNOST (idspec,nazspec) values (2,'Ortoped');
insert into IMA (lekar_idzap,specijalnost_idspec) values (2,2);
insert into SPECIJALNOST (idspec,nazspec) values (3,'Neurolog');
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (7,'Rista','Ristic', 'Lekar',null);
insert into LEKAR(idzap,brliclk) values (7,777777);
insert into ZAPOSLENI(idzap,imezap,przzap,tipzap,zaposleni_idzap) values (8,'Milica','Milic', 'Lekar',null);
insert into LEKAR(idzap,brliclk) values (8,888888);
insert into SPECIJALNOST (idspec,nazspec) values (4,'Pedijatar');
insert into IMA (lekar_idzap,specijalnost_idspec) values (7,4);
insert into IMA (lekar_idzap,specijalnost_idspec) values (8,4);

CREATE OR REPLACE VIEW 
lekari_specijalizacije (Ime, Prezime, Licenca, Specijalizacija, BrojLekara) AS    
with spec1 as (
 select i.specijalnost_idspec, count(i.lekar_idzap) "Broj_lekara_sa_tom_spec", s.nazspec
    from specijalnost s, ima i
   where s.idspec = i.specijalnost_idspec
   group by i.specijalnost_idspec,s.nazspec
   having count(i.lekar_idzap)>1)
select z.imezap, z.przzap, l.brliclk, s.nazspec, s."Broj_lekara_sa_tom_spec"
from lekar l,ima i, spec1 s, zaposleni z
where l.idzap = i.lekar_idzap and i.specijalnost_idspec = s.specijalnost_idspec and z.idzap = l.idzap and z.imezap like 'R%'
ORDER BY z.imezap;
